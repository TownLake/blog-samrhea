---
import Layout from '../layouts/Layout.astro';
import careerData from '../data/career.json';
import patentsData from '../data/patents.json';
import educationData from '../data/education.json';

export const prerender = true;

const getBrandColor = (name: string) => {
    if (name.includes('Cloudflare')) return 'text-accent-orange';
    if (name.includes('DevFactory')) return 'text-accent-red';
    if (name.includes('Ginor') || name.includes('Becker')) return 'text-accent-blue-muted';
    if (name.includes('University of Texas')) return 'text-[#BF5700]';
    if (name.includes('NOVA')) return 'text-[#00A5E0]';
    return 'text-white';
};

const getTimelineColor = (name: string) => {
    if (name.includes('Cloudflare')) return 'bg-accent-orange';
    if (name.includes('DevFactory')) return 'bg-accent-red';
    if (name.includes('Ginor') || name.includes('Becker')) return 'bg-accent-blue-muted';
    return 'bg-midnight-800';
};
---

<Layout title="About — Sam Rhea">
    <div class="space-y-16">
        
        <section class="space-y-4">
            <p class="text-base text-midnight-200 leading-relaxed">
                Hi there. My name is Sam. I am a Texan living in Lisbon. I work at Cloudflare.
            </p>
            <p class="text-base text-midnight-200 leading-relaxed">
                I'm probably busy right now building an application for a hobby project that doesn't need one. Or walking a dog we named after the second-worst highway in Austin.
            </p>
        </section>

        <section>
            <h2 class="text-xs font-mono text-midnight-500 uppercase tracking-widest mb-8">At Work</h2>
            
            <div class="relative">
                {/* Vertical Timeline Line */}
                <div class="absolute left-[11px] top-0 bottom-0 w-px bg-midnight-800"></div>

                <div class="space-y-12"> 
                    {careerData.map((job, jobIndex) => {
                        const isSingleRole = job.roles.length === 1;
                        const timelineColor = getTimelineColor(job.name);
                        const isLast = jobIndex === careerData.length - 1;
                        
                        return (
                            <div class="relative pl-12">
                                {/* Company-specific timeline segment */}
                                <div class={`absolute left-[11px] top-0 ${isLast ? 'bottom-0' : 'bottom-0'} w-px ${timelineColor} opacity-60`}></div>

                                {/* Timeline Dot/Logo */}
                                <div class="absolute left-0 top-0 bg-midnight-950 pb-4">
                                    {job.logo ? (
                                        <img src={job.logo} alt={job.name} class="w-6 h-6 object-contain rounded-sm bg-midnight-900/50" />
                                    ) : (
                                        <div class="w-6 h-6 bg-midnight-800 rounded-sm"></div>
                                    )}
                                </div>

                                {/* Company Header */}
                                <div class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between gap-2 mb-6 relative z-10">
                                    <h3 class={`text-base font-medium ${getBrandColor(job.name)}`}>{job.name}</h3>
                                    <span class="text-sm font-mono text-midnight-500 tabular-nums">{job.period}</span>
                                </div>

                                <div class="space-y-10 relative z-10">
                                    {job.roles.map((role) => (
                                        <div>
                                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline mb-3">
                                                <h4 class="text-sm font-medium text-midnight-200">{role.title}</h4>
                                                {/* Only show role date if there are multiple roles to distinguish timeline */}
                                                {!isSingleRole && (
                                                    <span class="text-xs text-midnight-500 font-mono tabular-nums">{role.period}</span>
                                                )}
                                            </div>
                                            
                                            <div class="text-sm text-midnight-400 leading-relaxed">
                                                {role.achievements.map((achievement, index) => {
                                                    // Helper to render content with links
                                                    const content = Array.isArray(achievement) ? (
                                                        <span>
                                                            {achievement.map(part => 
                                                                typeof part === 'string' ? part : 
                                                                <a href={part.link} 
                                                                   target="_blank" 
                                                                   rel="noopener noreferrer"
                                                                   class="text-accent-blue underline underline-offset-2 hover:text-white transition-colors duration-150">
                                                                   {part.text}
                                                                </a>
                                                            )}
                                                        </span>
                                                    ) : achievement;

                                                    // First item is a paragraph (no dash), others are list items (with dash)
                                                    if (index === 0) {
                                                        return <div class="mb-3">{content}</div>;
                                                    }

                                                    return (
                                                        <div class="flex gap-3 items-baseline mb-2">
                                                            <span class="flex-shrink-0 text-midnight-500 select-none">–</span>
                                                            <span>{content}</span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </section>

        <section>
            <h2 class="text-xs font-mono text-midnight-500 uppercase tracking-widest mb-6">Patents</h2>
            <div class="space-y-4">
                {patentsData.map((patent) => (
                    <a href={patent.link} target="_blank" rel="noopener noreferrer" class="block group">
                        <div class="flex items-baseline justify-between gap-4 mb-1">
                            <h3 class="text-sm text-midnight-200 font-medium group-hover:text-white transition-colors duration-150">{patent.title}</h3>
                            <span class="text-xs font-mono text-midnight-600 tabular-nums flex-shrink-0">{patent.patentNumber}</span>
                        </div>
                        <p class="text-sm text-midnight-400">{patent.description}</p>
                    </a>
                ))}
            </div>
        </section>

        <section>
            <h2 class="text-xs font-mono text-midnight-500 uppercase tracking-widest mb-6">Teaching</h2>
            <div class="space-y-10">
                {educationData.filter(school => school.name.includes('NOVA')).map((school) => (
                    <div class="group">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="w-10 h-10 flex-shrink-0 bg-midnight-900 rounded-lg p-1.5 border border-midnight-800">
                                <img src={school.logo} alt={school.name} class="w-full h-full object-contain" />
                            </div>
                            <div class="flex-grow min-w-0">
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline gap-1">
                                    <h3 class={`text-base font-medium ${getBrandColor(school.name)}`}>{school.name}</h3>
                                    <span class="text-xs font-mono text-midnight-500 tabular-nums">{school.period}</span>
                                </div>
                                {school.roles.map(role => (
                                    <div class="mt-1">
                                        <p class="text-sm text-midnight-200">{role.title}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        {school.sections && school.sections.length > 0 && (
                            <div class="ml-14 space-y-4">
                                {school.sections.map(sec => (
                                    <div>
                                        <h4 class="text-[10px] font-medium text-midnight-600 uppercase tracking-widest mb-2">{sec.title}</h4>
                                        <ul class="space-y-1">
                                            {sec.items.map((item) => (
                                                <li class="text-sm text-midnight-400 flex items-baseline gap-2">
                                                    <span class="text-midnight-700 select-none">·</span>
                                                    {typeof item === 'string' 
                                                        ? <span>{item}</span>
                                                        : <a href={item.link} target="_blank" rel="noopener noreferrer" class="text-accent-blue underline underline-offset-2 hover:text-white transition-colors duration-150">{item.text}</a>
                                                    }
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                ))}
            </div>
        </section>

        <section>
            <h2 class="text-xs font-mono text-midnight-500 uppercase tracking-widest mb-6">Studying</h2>
            <div class="space-y-10">
                {educationData.filter(school => !school.name.includes('NOVA')).map((school) => (
                    <div class="group">
                        <div class="flex items-start gap-4 mb-4">
                            <div class="w-10 h-10 flex-shrink-0 bg-midnight-900 rounded-lg p-1.5 border border-midnight-800">
                                <img src={school.logo} alt={school.name} class="w-full h-full object-contain" />
                            </div>
                            <div class="flex-grow min-w-0">
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline gap-1">
                                    <h3 class={`text-base font-medium ${getBrandColor(school.name)}`}>{school.name}</h3>
                                    <span class="text-xs font-mono text-midnight-500 tabular-nums">{school.period}</span>
                                </div>
                                {school.roles.map(role => (
                                    <div class="mt-1">
                                        <p class="text-sm text-midnight-200">{role.title}</p>
                                        {role.achievements[0] && (
                                            <p class="text-sm text-midnight-500 mt-0.5">{role.achievements[0]}</p>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        {school.sections && school.sections.length > 0 && (
                            <div class="ml-14 space-y-4">
                                {school.sections.map(sec => (
                                    <div>
                                        <h4 class="text-[10px] font-medium text-midnight-600 uppercase tracking-widest mb-2">{sec.title}</h4>
                                        <ul class="space-y-1">
                                            {sec.items.map((item) => (
                                                <li class="text-sm text-midnight-400 flex items-baseline gap-2">
                                                    <span class="text-midnight-700 select-none">·</span>
                                                    {typeof item === 'string' 
                                                        ? <span>{item}</span>
                                                        : <a href={item.link} target="_blank" rel="noopener noreferrer" class="text-accent-blue underline underline-offset-2 hover:text-white transition-colors duration-150">{item.text}</a>
                                                    }
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                ))}
            </div>
        </section>
    </div>
</Layout>