---
import Layout from '../layouts/Layout.astro';
import careerData from '../data/career.json';
import patentsData from '../data/patents.json';
import educationData from '../data/education.json';

const getBrandColor = (name: string) => {
    if (name.includes('Cloudflare')) return 'text-accent-orange';
    if (name.includes('DevFactory')) return 'text-accent-red';
    if (name.includes('Ginor') || name.includes('Becker')) return 'text-accent-blue-muted';
    if (name.includes('University of Texas')) return 'text-[#BF5700]';
    return 'text-white';
};

const getTimelineColor = (name: string) => {
    if (name.includes('Cloudflare')) return 'bg-accent-orange';
    if (name.includes('DevFactory')) return 'bg-accent-red';
    if (name.includes('Ginor') || name.includes('Becker')) return 'bg-accent-blue-muted';
    return 'bg-midnight-800';
};
---

<Layout title="Sam Rhea">
    <div class="space-y-20">
        
        <section>
            <div class="prose prose-invert prose-midnight max-w-none text-midnight-100 text-xl leading-relaxed font-light">
                <p>
                    Hi there. My name is Sam. I am a Texan living in Lisbon. I work at Cloudflare.
                </p>
                <p>
                    I'm probably busy right now building an application for a hobby project that doesn't need one. Or walking a dog we named after the second-worst highway in Austin.
                </p>
            </div>
        </section>

        <section>
            <h2 class="text-sm font-mono text-midnight-400 uppercase tracking-wider mb-12">At Work</h2>
            
            <div class="relative">
                {/* Vertical Timeline Line */}
                <div class="absolute left-[11px] top-2 bottom-0 w-px bg-midnight-800"></div>

                <div class="space-y-16"> 
                    {careerData.map((job) => {
                        const isSingleRole = job.roles.length === 1;
                        const timelineColor = getTimelineColor(job.name);
                        
                        return (
                            <div class="relative pl-12">
                                {/* Company-specific timeline segment */}
                                <div class={`absolute left-[11px] top-2 bottom-4 w-px ${timelineColor} opacity-50`}></div>

                                {/* Timeline Dot/Logo */}
                                <div class="absolute left-0 top-0 bg-midnight-950 pb-4">
                                    {job.logo ? (
                                        <img src={job.logo} alt={job.name} class="w-6 h-6 object-contain rounded-sm bg-midnight-900/50" />
                                    ) : (
                                        <div class="w-6 h-6 bg-midnight-800 rounded-sm"></div>
                                    )}
                                </div>

                                {/* Company Header */}
                                <div class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between gap-2 mb-6 relative z-10">
                                    <h3 class={`text-xl font-semibold ${getBrandColor(job.name)}`}>{job.name}</h3>
                                    <span class="text-sm font-mono text-midnight-500 tabular-nums">{job.period}</span>
                                </div>

                                <div class="space-y-10 relative z-10">
                                    {job.roles.map((role) => (
                                        <div>
                                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline mb-3">
                                                <h4 class="text-base font-medium text-white">{role.title}</h4>
                                                {/* Only show role date if there are multiple roles to distinguish timeline */}
                                                {!isSingleRole && (
                                                    <span class="text-xs text-midnight-500 font-mono tabular-nums">{role.period}</span>
                                                )}
                                            </div>
                                            
                                            <div class="text-base text-midnight-200 leading-relaxed">
                                                {role.achievements.map((achievement, index) => {
                                                    // Helper to render content with links
                                                    const content = Array.isArray(achievement) ? (
                                                        <span>
                                                            {achievement.map(part => 
                                                                typeof part === 'string' ? part : 
                                                                <a href={part.link} 
                                                                   target="_blank" 
                                                                   class="text-accent-blue font-medium hover:text-white transition-colors no-underline">
                                                                   {part.text}
                                                                </a>
                                                            )}
                                                        </span>
                                                    ) : achievement;

                                                    // First item is a paragraph (no dash), others are list items (with dash)
                                                    if (index === 0) {
                                                        return <div class="mb-3">{content}</div>;
                                                    }

                                                    return (
                                                        <div class="flex gap-3 items-baseline mb-2">
                                                            <span class="flex-shrink-0 text-midnight-500 select-none">â€“</span>
                                                            <span>{content}</span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </section>

        <section>
            <h2 class="text-sm font-mono text-midnight-400 uppercase tracking-wider mb-8">Patents</h2>
            <div class="grid gap-4">
                {patentsData.map((patent) => (
                    <a href={patent.link} target="_blank" class="block group p-6 rounded-lg border border-midnight-800 bg-midnight-900/20 hover:border-midnight-600 hover:bg-midnight-900/40 transition-all">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="text-lg text-white font-medium group-hover:text-accent-blue transition-colors">{patent.title}</h3>
                            <span class="text-xs font-mono text-midnight-500 tabular-nums">{patent.patentNumber}</span>
                        </div>
                        <p class="text-sm text-midnight-300 leading-relaxed line-clamp-2">{patent.description}</p>
                    </a>
                ))}
            </div>
        </section>

        <section>
            <h2 class="text-sm font-mono text-midnight-400 uppercase tracking-wider mb-8">Education</h2>
            <div class="space-y-12">
                {educationData.map((school) => (
                    <div class="flex gap-6 items-start">
                        <div class="w-12 h-12 flex-shrink-0 bg-white/5 rounded p-2 border border-midnight-800">
                             <img src={school.logo} class="w-full h-full object-contain opacity-90" />
                        </div>
                        <div class="flex-grow">
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-baseline mb-1">
                                <h3 class={`text-lg font-medium ${getBrandColor(school.name)}`}>{school.name}</h3>
                                <p class="text-sm font-mono text-midnight-500 tabular-nums">{school.period}</p>
                            </div>
                            
                            {school.roles.map(degree => (
                                <div class="mb-6">
                                    <p class="text-base text-white font-medium">{degree.title}</p>
                                    <p class="text-sm text-midnight-300 mt-1">{degree.achievements[0]}</p>
                                </div>
                            ))}

                            <div class="grid sm:grid-cols-2 gap-y-6 gap-x-8">
                                {school.sections && school.sections.map(sec => (
                                    <div>
                                        <span class="block text-[10px] font-bold text-midnight-500 uppercase tracking-widest mb-2">{sec.title}</span>
                                        <div class="text-sm text-midnight-300 leading-relaxed">
                                            {sec.items.map((item, i) => (
                                                <span class="inline-block">
                                                    {typeof item === 'string' ? item : <a href={item.link} class="text-accent-blue hover:text-white transition-colors">{item.text}</a>}
                                                    {i < sec.items.length - 1 && <span class="mr-1">,</span>}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </section>
    </div>
</Layout>