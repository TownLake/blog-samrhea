---
import { getEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export const prerender = true;

export async function getStaticPaths() {
    const { getCollection } = await import('astro:content');
    const posts = await getCollection('posts');
    return posts.map(post => ({
        params: { slug: post.slug },
    }));
}

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

const post = await getEntry('posts', slug);

if (!post) {
  return Astro.redirect('/404');
}

const { Content } = await post.render();

const postDate = new Date(post.data.date);
const displayDate = postDate.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'short', 
    day: 'numeric' 
});
---

<Layout title={`${post.data.title} â€” Sam Rhea`} description={post.data.description}>
    <article class="w-full">
        
        <header class="mb-10">
            <nav class="mb-8">
                <a href="/" class="text-sm text-midnight-500 hover:text-midnight-200 transition-colors duration-150 inline-flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                    </svg>
                    Writing
                </a>
            </nav>

            <h1 class="text-2xl md:text-3xl font-semibold tracking-tight text-white leading-tight mb-4">
                {post.data.title}
            </h1>

            <div class="flex items-center gap-4 text-sm text-midnight-500">
                <time datetime={postDate.toISOString()} class="font-mono text-xs">
                    {displayDate}
                </time>
                <button 
                    id="copy-url-btn" 
                    class="font-mono text-xs hover:text-midnight-300 transition-colors duration-150 flex items-center gap-1.5"
                >
                    <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    <span id="copy-text">Copy link</span>
                </button>
            </div>
        </header>
        
        <div class="prose prose-invert prose-midnight max-w-none">
             <Content />
        </div>
    </article>
</Layout>

<script>
    const copyBtn = document.getElementById('copy-url-btn');
    const copyText = document.getElementById('copy-text');

    if (copyBtn && copyText) {
        copyBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const originalText = copyText.innerText;
                copyText.innerText = 'Copied';
                setTimeout(() => {
                    copyText.innerText = originalText;
                }, 1500);
            });
        });
    }
</script>